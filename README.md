# Android Malware Attack Detection (Under Construction)
[__Spring 2017 Galvanize Data Science Immersive__](https://www.galvanize.com/austin)
<img src="images/Samsung_Galaxy_Mr_Robot.png" height=25%  width=25%  alt="What's hiding inside your phone?" ALIGN="right">
An Investigation of Android mobile Malware using the SherLock dataset and Big Data Tools.

This project uses the SherLock dataset and an Apache Spark cluster running on Amazon EMR to train machine learning algorithms to identify malicious activity in Android mobile handset logs.  

All of the log time-series slicing, feature vectorization, training, and classification of malicious/not-malicious activity was done inside the Spark cluster using PySpark and SparkML.


See this work as a presentation in [Google Slides](https://docs.google.com/presentation/d/1fFDJEPQBMHpbmsuY1YMRZR-Qu2Rx3q4-L_taB1lxBmE/edit?usp=sharing).

<br clear="right">

# Background & Motivation

To properly investigate mobile device malware, one must focus on the platforms on which most malware resides.  Currently, >85% of smartphone devices operate the Android OS, while [99% of mobile malware](https://safeandsavvy.f-secure.com/2017/02/15/another-reason-99-percent-of-mobile-malware-targets-androids/) is found on the Android platform.

<img src="images/20160822_android_ios_businessinsider.png" height=60%, width=60%, alt="Mobile OS Market Share"><br>Figure __XX__. Smartphone Mobile OS Market Share, 2009-2016

For this project, I chose to focus on a specific type of malware known as ransomware, due to the  [rapidly increasing threat](https://usa.kaspersky.com/about/press-releases/2017_kaspersky-lab-reports-mobile-ransomware-dramatically-increased-in-q1-2017) and high visibility in the news (see [WannaCry](https://en.wikipedia.org/wiki/WannaCry_ransomware_attack)).  

Ransomware is a type of malware wherein the malicious code encrypts portions of the device data storage and demands payment from the victim to unlock the data.



# Enter the SherLock Experiment

What is the SherLock Dataset?
> A long-term smartphone sensor dataset with a high temporal resolution. The dataset also offers explicit labels capturing the activity of malwares running on the devices. The dataset currently contains 10 billion data records from 30 users collected over a period of 2 years and an additional 20 users for 10 months (totaling 50 active users currently participating in the experiment).

>The primary purpose of the dataset is to help security professionals and academic researchers in developing innovative methods of implicitly detecting malicious behavior in smartphones. Specifically, from data obtainable without superuser (root) privileges. However, this dataset can be used for research in domains that are not strictly security related. For example, context aware recommender systems, event prediction, user personalization and awareness, location prediction, and more. The dataset also offers opportunities that aren't available in other datasets. For example, the dataset contains the SSID and signal strength of the connected WiFi access point (AP) which is sampled once every second, over the course of many months.

One of the interesting aspects of the SherLock dataset is the researchers' use of custom-written "simulated" malware.  Across a range of malware types, the researchers write custom malware application packages that perform the same activities as existing malware, albeit in a non-destructive way.  For example, much like existing malware, the malware only performs malicious activities at random times.  By performing the same actions as real malware and in the same manner, the phone's internal state sensors accurately capture the usage patterns and context of a real attack.

Furthermore, to aid in investigative efforts, the SherLock application consists of two parts: the Moriarty package which simulates the attack and leaves clues in the log of malicious or benign activity, and the SherLock package, which monitors the sensors and internal state of the device as explained above.  By combining the Moriarty clues with the SherLock sensor data, machine-learning models can be trained to recognize an attack event.

More information on the data set and methods of collection can be found here: [http://bigdata.ise.bgu.ac.il/sherlock/](http://bigdata.ise.bgu.ac.il/sherlock/)



# Analysis methods

The full SherLock dataset is quite large, over 600 billion data points in 10 billion records, with an on-disk size of approximately 6TB.  




<img src="images/Data_management.png" height=70%, width=70%, alt="Data Management Pipeline"><br>Figure __XX__. Data management Pipeline

<img src="images/Spark_dag_labeled.png" height=80%, width=80%, alt="Spark DAG"><br>Figure __XX__. Spark Directed Acyclic Graph

# Predicting malware events

<img src="images/Results_conf_matrix.png" height=80%, width=80%, alt="Results"><br>Figure __XX__. Confusion Matrix Predicting malware events.


# Future improvements

An ideal threat detection method would continuously monitor the mobile device's running processes and internal state, raising a flag as soon as possible after a malicious event begins.  However, continuous monitoring uses significant battery life and a trade-off must be made to balance the user's desire for longer battery lifetime against the economic or efficiency lost to disruption of the device availability.
Predicting malware attack given discreet time slices is an easier task than a continuous time-series


# Acknowledgements

My sincere thanks to [Yisroel Mirsky](yisroel@post.bgu.ac.il) of Ben-Gurion University of the Negev, Dept. of Software and Information Systems Engineering  

# References :
[Mirsky, Yisroel, et al. "SherLock vs Moriarty: A Smartphone Dataset for Cybersecurity Research." Proceedings of the 2016 ACM Workshop on Artificial Intelligence and Security. ACM, 2016.](https://drive.google.com/file/d/0B_A1qX1kf7R9OVhhVk5wNjkydkU/view?usp=sharing)

[Guillermo Suarez-Tangil, Juan E Tapiador, Pedro Peris-Lopez, and Arturo Ribagorda. Evolution, detection and analysis of malware for smart devices. Communications Surveys & Tutorials, IEEE, 16(2):961â€“987, 2014.](https://pdfs.semanticscholar.org/8005/2ba5ef7339058829ddb0e9a8289b5a275c48.pdf)
